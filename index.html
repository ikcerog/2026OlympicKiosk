<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Milano Cortina 2026 Kiosk Dashboard (Final)</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Montserrat:ital,wght@0,100..900;1,100..900&family=TASA+Explorer:wght@400..800&display=swap');
    </style>

    <style>
        :root {
            --font-primary: 'Inter', sans-serif;
            --font-heading: 'TASA Explorer', sans-serif;
            --color-gold: #FFD700;
            --color-silver: #C0C0C0;
            --color-bronze: #CD7F32;
            --color-background: #002244;
            --color-text-light: #F0F8FF;
            --color-accent: #E30613;
            --control-height: 80px;
            
            /* Base Font Sizes (using viewport units for dynamic scaling) */
            --font-size-h1: 3.5vw;
            --font-size-h2: 2.0vw;
            --font-size-base: 1.5vw;
            --font-size-lg: 1.8vw;

            /* Max size constraints for ultra-wide screens */
            --max-font-size-button: 20px;
            --max-width-button: 200px;
            --max-font-size-dropdown: 18px;
        }
        
        body {
            font-family: var(--font-primary);
            color: var(--color-text-light);
            margin: 0;
            padding: 0;
            overflow: hidden; 
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        /* --- DYNAMIC BACKGROUND LAYERS --- */
        .background-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            opacity: 0;
            transition: opacity 1s ease-in-out; 
            filter: blur(5px) brightness(0.7);
            z-index: -1;
        }
        
        #bg-1 { background-image: url('./img/001.jpg'); opacity: 1; }
        #bg-2 { background-image: url('./img/002.jpg'); }

        /* Foreground Gradient Overlay */
        #gradient-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 34, 68, 0.7);
            z-index: -1;
        }

        /* --- HISTORICAL DATA DROPDOWN --- */
        #historical-data {
            position: absolute;
            top: 20px;
            right: 50px;
            z-index: 50;
        }
        #historical-data select {
            background-color: rgba(255, 255, 255, 0.2);
            color: var(--color-text-light);
            border: 1px solid var(--color-gold);
            padding: 8px 15px;
            border-radius: 5px;
            font-family: var(--font-heading);
            font-size: clamp(14px, 1.2vw, var(--max-font-size-dropdown));
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3E%3Cpath fill='%23F0F8FF' d='M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 6.757 7.586 5.343 9z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 1.5em;
        }
        #historical-data select:focus {
            outline: none;
            border-color: var(--color-accent);
        }


        /* --- DASHBOARD ELEMENTS --- */
        #dashboard-container {
            width: 100%;
            height: calc(100% - var(--control-height)); 
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            background: rgba(0, 0, 0, 0.1);
        }

        .panel {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 30px 50px;
            box-sizing: border-box;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .panel.active {
            opacity: 1;
            z-index: 10;
        }
        
        h1 { 
            font-family: var(--font-heading); 
            font-size: var(--font-size-h1);
            margin-bottom: 5px; 
            font-weight: 800;
        }
        h2 { 
            font-family: var(--font-heading); 
            font-size: var(--font-size-h2);
            border-bottom: 3px solid var(--color-accent); 
            padding-bottom: 5px; 
            margin-bottom: 20px;
            font-weight: 600;
        }

        /* Emojis/Flags in Panel Text */
        .event-list .sport::before, .flag-emoji, #spotlight .logo {
            font-size: var(--font-size-lg); 
            margin-right: 10px;
        }

        /* Panel 1: Schedule */
        .event-list {
            list-style: none;
            padding: 0;
            width: 95%;
            max-height: 80%;
            overflow-y: auto;
            text-align: left;
            font-family: var(--font-primary);
        }
        .event-list li {
            background: rgba(255, 255, 255, 0.15);
            margin-bottom: 8px;
            padding: 12px 18px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: var(--font-size-base);
        }
        .event-list .time { 
            color: var(--color-gold); 
            font-weight: 700; 
            font-family: var(--font-heading); 
            font-size: var(--font-size-lg);
        }

        /* Panel 2: Medal Tally - Chart Container */
        #medal-tally-chart-container {
            width: 95%;
            height: 70vh;
            margin-top: 10px;
            /* FIX: Ensure tooltips render above the canvas */
            position: relative; 
            z-index: 1;
        }

        /* Panel 3: Spotlight */
        #spotlight .countdown {
            font-size: 8vw;
            font-weight: 800;
            font-family: var(--font-heading); 
            color: var(--color-gold);
            margin-top: 20px;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
        #spotlight p { font-size: var(--font-size-lg); margin-top: 10px; }

        /* KIOSK CONTROLS */
        #kiosk-controls {
            width: 100%;
            height: var(--control-height);
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px 0;
            box-sizing: border-box;
            z-index: 20;
        }
        .control-button {
            background-color: var(--color-accent);
            color: var(--color-text-light);
            border: none;
            padding: 15px 30px;
            margin: 0 10px;
            
            /* Apply max size constraints */
            font-size: clamp(14px, 1.2vw, var(--max-font-size-button));
            max-width: var(--max-width-button);
            
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
            font-weight: 600;
            font-family: var(--font-heading);
        }
        .control-button:hover {
            background-color: #A9040F;
        }
        .control-button:disabled {
            background-color: #333;
            cursor: not-allowed;
        }
        #speed-toggle {
            background-color: #555;
        }
        #speed-toggle:hover {
            background-color: #777;
        }
        
        /* --- MOBILE/VERTICAL SCREEN STYLING (Responsive Flow) --- */
        @media (max-width: 768px), (orientation: portrait) {
            :root {
                --font-size-h1: 7vw;
                --font-size-h2: 4.5vw;
                --font-size-base: 3.5vw;
                --font-size-lg: 4.5vw;
                --control-height: 10vh;
            }

            .panel {
                padding: 20px;
            }
            
            #historical-data {
                top: 10px;
                right: 10px;
            }
            
            #spotlight .countdown {
                font-size: 15vw;
            }
            
            #kiosk-controls {
                flex-wrap: wrap;
                justify-content space-around;
                padding: 5px;
            }

            .control-button {
                padding: 10px 15px;
                margin: 5px;
                font-size: 3vw;
                flex-grow: 1;
                min-width: 40%;
                max-width: 100%;
            }
            
            #medal-tally-chart-container {
                height: 60vh;
            }
        }
    </style>
</head>
<body>
    
    <div id="bg-1" class="background-layer"></div>
    <div id="bg-2" class="background-layer"></div>
    <div id="gradient-overlay"></div>
    
    <div id="historical-data">
        <select id="event-selector">
            <option value="2026-current">Milano Cortina 2026 (Current)</option>
            <option value="2022-winter">Beijing 2022 (Winter)</option>
            <option value="2020-summer">Tokyo 2020 (Summer)</option>
            <option value="2018-winter">PyeongChang 2018 (Winter)</option>
        </select>
    </div>

    <div id="dashboard-container">

        <div id="schedule" class="panel active">
            <h1>üìÖ TODAY'S SCHEDULE</h1>
            <h2>Upcoming Medal Events</h2>
            <ul class="event-list"></ul>
        </div>

        <div id="medal-tally" class="panel">
            <h1>üèÖ MEDAL STANDINGS</h1>
            <h2 id="medal-tally-subtitle">Top 10 Nations (Stacked Bar Chart)</h2>
            <div id="medal-tally-chart-container">
                <canvas id="medalChart"></canvas>
            </div>
        </div>

        <div id="spotlight" class="panel">
            <div class="logo">üáÆüáπüèîÔ∏è</div>
            <h1>MILANO CORTINA 2026</h1>
            <h2>Countdown to the Games</h2>
            <div id="countdown-timer" class="countdown">-- days --</div>
            <p>February 6 ‚Äì 22, 2026</p>
        </div>

    </div>

    <div id="kiosk-controls">
        <button id="prev-button" class="control-button">‚¨ÖÔ∏è BACK</button>
        <button id="pause-button" class="control-button">‚è∏Ô∏è PAUSE</button>
        <button id="next-button" class="control-button">FORWARD ‚û°Ô∏è</button>
        <button id="speed-toggle" class="control-button">üê¢ SLOW SWAP (15s)</button>
    </div>

    <script>
        // --- 1. MOCK DATA ---
        
        const MOCK_DATA_2026 = [
            { rank: 1, country: "Norway", code: "NOR", G: 16, S: 8, B: 13, T: 37 },
            { rank: 2, country: "Germany", code: "GER", G: 12, S: 10, B: 5, T: 27 },
            { rank: 3, country: "Canada", code: "CAN", G: 4, S: 8, B: 14, T: 26 },
            { rank: 4, country: "USA", code: "USA", G: 8, S: 10, B: 7, T: 25 },
            { rank: 5, country: "Sweden", code: "SWE", G: 8, S: 5, B: 5, T: 18 },
            { rank: 6, country: "Austria", code: "AUT", G: 7, S: 7, B: 4, T: 18 },
            { rank: 7, country: "Italy", code: "ITA", G: 2, S: 7, B: 8, T: 17 },
            { rank: 8, country: "Japan", code: "JPN", G: 3, S: 6, B: 9, T: 18 },
            { rank: 9, country: "Netherlands", code: "NED", G: 8, S: 5, B: 4, T: 17 },
            { rank: 10, country: "China", code: "CHN", G: 9, S: 4, B: 2, T: 15 },
        ].sort((a, b) => b.T - a.T); 
        
        const MOCK_DATA_2022 = [
            { rank: 1, country: "Norway", code: "NOR", G: 16, S: 8, B: 13, T: 37 },
            { rank: 2, country: "Germany", code: "GER", G: 12, S: 10, B: 5, T: 27 },
            { rank: 3, country: "China", code: "CHN", G: 9, S: 4, B: 2, T: 15 },
            { rank: 4, country: "USA", code: "USA", G: 8, S: 10, B: 7, T: 25 },
            { rank: 5, country: "Sweden", code: "SWE", G: 8, S: 5, B: 5, T: 18 },
            { rank: 6, country: "Netherlands", code: "NED", G: 8, S: 5, B: 4, T: 17 },
            { rank: 7, country: "Austria", code: "AUT", G: 7, S: 7, B: 4, T: 18 },
            { rank: 8, country: "Switzerland", code: "SUI", G: 7, S: 2, B: 5, T: 14 },
            { rank: 9, country: "ROC", code: "RUS", G: 6, S: 12, B: 14, T: 32 },
            { rank: 10, country: "France", code: "FRA", G: 5, S: 7, B: 2, T: 14 },
        ].sort((a, b) => b.T - a.T);

        const MOCK_DATA_2020 = [
            { rank: 1, country: "USA", code: "USA", G: 39, S: 41, B: 33, T: 113 },
            { rank: 2, country: "China", code: "CHN", G: 38, S: 32, B: 19, T: 89 },
            { rank: 3, country: "Japan", code: "JPN", G: 27, S: 14, B: 17, T: 58 },
            { rank: 4, country: "Great Britain", code: "GBR", G: 22, S: 21, B: 22, T: 65 },
            { rank: 5, country: "Australia", code: "AUS", G: 17, S: 7, B: 22, T: 46 },
            { rank: 6, country: "Netherlands", code: "NED", G: 10, S: 12, B: 14, T: 36 },
            { rank: 7, country: "France", code: "FRA", G: 10, S: 12, B: 11, T: 33 },
            { rank: 8, country: "Germany", code: "GER", G: 10, S: 11, B: 16, T: 37 },
            { rank: 9, country: "Italy", code: "ITA", G: 10, S: 10, B: 20, T: 40 },
            { rank: 10, country: "Canada", code: "CAN", G: 7, S: 7, B: 10, T: 24 },
        ].sort((a, b) => b.T - a.T);
        
        const scheduleData = [
            { sport: "Alpine Skiing", event: "Women's Downhill Final", time: "09:30 AM CET" },
            { sport: "Curling", event: "Men's Gold Medal Match", time: "11:00 AM CET" },
            { sport: "Biathlon", event: "Mixed 4x6km Relay", time: "01:30 PM CET" },
            { sport: "Figure Skating", event: "Ice Dance Free Skate", time: "03:00 PM CET" },
            { sport: "Speed Skating", event: "Men's 500m Final", time: "04:30 PM CET" },
            { sport: "Bobsleigh", event: "Women's Monobob Run 3", time: "06:00 PM CET" },
            { sport: "Ice Hockey", event: "Men's Group A: SWE vs FIN", time: "08:00 PM CET" }
        ];

        function getFlagEmoji(code) {
            const flags = {
                'NOR': 'üá≥üá¥', 'GER': 'üá©üá™', 'CAN': 'üá®üá¶', 'USA': 'üá∫üá∏', 'SWE': 'üá∏üá™',
                'AUT': 'üá¶üáπ', 'ITA': 'üáÆüáπ', 'JPN': 'üáØüáµ', 'NED': 'üá≥üá±', 'CHN': 'üá®üá≥',
                'SUI': 'üá®üá≠', 'RUS': 'üá∑üá∫', 'FRA': 'üá´üá∑', 'GBR': 'üá¨üáß', 'AUS': 'üá¶üá∫',
                'KOR': 'üá∞üá∑'
            };
            return flags[code] || 'üö©';
        }
        
        let medalChart; 

        // --- 2. DATA RENDERING FUNCTIONS ---
        
        function loadHistoricalData(eventKey) {
            let data;
            let title;

            switch (eventKey) {
                case '2022-winter':
                    data = MOCK_DATA_2022;
                    title = "Beijing 2022 Medal Count (Winter)";
                    break;
                case '2020-summer':
                    data = MOCK_DATA_2020;
                    title = "Tokyo 2020 Medal Count (Summer)";
                    break;
                case '2018-winter':
                    data = MOCK_DATA_2022; // Using 2022 data as placeholder for 2018
                    title = "PyeongChang 2018 Medal Count (Winter)";
                    break;
                case '2026-current':
                default:
                    data = MOCK_DATA_2026;
                    title = "Top 10 Nations (Stacked Bar Chart)";
                    break;
            }
            
            document.getElementById('medal-tally-subtitle').textContent = title;
            renderMedalTally(data);
        }

        function renderMedalTally(currentData = MOCK_DATA_2026) {
            const ctx = document.getElementById('medalChart').getContext('2d');
            
            const getComputedFontSize = (baseVW) => {
                const vw = window.innerWidth / 100;
                return Math.min(baseVW * vw, 24) + 'px'; 
            };
            
            const chartFontSizeBase = getComputedFontSize(1.2); 
            const chartFontSizeHeading = getComputedFontSize(1.6); 

            const labels = currentData.map(c => `${getFlagEmoji(c.code)} ${c.country} (${c.T})`);
            const goldData = currentData.map(c => c.G);
            const silverData = currentData.map(c => c.S);
            const bronzeData = currentData.map(c => c.B);
            
            const textColor = document.documentElement.style.getPropertyValue('--color-text-light') || '#F0F8FF';

            if (medalChart) {
                medalChart.destroy();
            }

            medalChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Bronze',
                            data: bronzeData,
                            backgroundColor: document.documentElement.style.getPropertyValue('--color-bronze') || '#CD7F32',
                            borderColor: 'var(--color-background)',
                            borderWidth: 1
                        },
                        {
                            label: 'Silver',
                            data: silverData,
                            backgroundColor: document.documentElement.style.getPropertyValue('--color-silver') || '#C0C0C0',
                            borderColor: 'var(--color-background)',
                            borderWidth: 1
                        },
                        {
                            label: 'Gold',
                            data: goldData,
                            backgroundColor: document.documentElement.style.getPropertyValue('--color-gold') || '#FFD700',
                            borderColor: 'var(--color-background)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    indexAxis: 'y', 
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: textColor, font: { size: chartFontSizeBase, family: 'var(--font-primary)' } },
                            title: { display: true, text: 'Total Medals', color: textColor, font: { size: chartFontSizeHeading, family: 'var(--font-heading)' } }
                        },
                        y: {
                            stacked: true,
                            grid: { display: false },
                            ticks: { color: textColor, font: { size: chartFontSizeBase, family: 'var(--font-primary)' } }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: textColor,
                                font: { size: chartFontSizeHeading, family: 'var(--font-heading)' },
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            // --- Tooltip Styling Fix ---
                            color: textColor, // Ensures text color is white
                            backgroundColor: 'rgba(0, 34, 68, 0.95)',
                            borderColor: 'var(--color-gold)',
                            borderWidth: 1,
                            bodyColor: textColor,
                            titleColor: textColor,
                            // ---------------------------
                            bodyFont: { size: chartFontSizeBase, family: 'var(--font-primary)' },
                            titleFont: { size: chartFontSizeHeading, family: 'var(--font-heading)' }
                        }
                    }
                }
            });
        }
        
        function renderSchedule() {
            const list = document.querySelector('#schedule .event-list');
            list.innerHTML = '';
            scheduleData.forEach(event => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `
                    <span class="sport">${event.sport}: ${event.event}</span>
                    <span class="time">${event.time}</span>
                `;
                list.appendChild(listItem);
            });
        }

        function updateCountdown() {
            const targetDate = new Date("Feb 6, 2026 00:00:00 EST").getTime();
            const now = new Date().getTime();
            const distance = targetDate - now;

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            
            const countdownEl = document.getElementById("countdown-timer");

            if (distance < 0) {
                countdownEl.innerHTML = "GAMES ARE LIVE!";
            } else {
                countdownEl.innerHTML = `${days} Days to Go`;
            }
        }

        // --- 3. ROTATION LOGIC & BACKGROUND SWAP ---

        const panels = document.querySelectorAll('.panel');
        const nextButton = document.getElementById('next-button');
        const prevButton = document.getElementById('prev-button');
        const pauseButton = document.getElementById('pause-button');
        const speedToggle = document.getElementById('speed-toggle');
        const bg1 = document.getElementById('bg-1');
        const bg2 = document.getElementById('bg-2');
        const eventSelector = document.getElementById('event-selector');

        let currentPanelIndex = 0;
        let rotationIntervalId;
        
        const SPEED_SLOW = 15000;
        const SPEED_FAST = 5000;
        let currentRotationSpeed = SPEED_SLOW;
        let isPaused = false;
        let activeBackground = 1;

        function startRotation() {
            if (rotationIntervalId) {
                clearInterval(rotationIntervalId);
            }
            if (!isPaused) {
                rotationIntervalId = setInterval(rotatePanel, currentRotationSpeed);
            }
        }
        
        function changeBackgroundOnPanelCycle() {
            if (activeBackground === 1) {
                bg1.style.opacity = 0;
                bg2.style.opacity = 1;
                activeBackground = 2;
            } else {
                bg1.style.opacity = 1;
                bg2.style.opacity = 0;
                activeBackground = 1;
            }
        }

        function rotatePanel(direction = 1) {
            panels[currentPanelIndex].classList.remove('active');
            
            currentPanelIndex = (currentPanelIndex + direction + panels.length) % panels.length;
            
            panels[currentPanelIndex].classList.add('active');

            // Hide/Show dropdown based on panel
            if (panels[currentPanelIndex].id === 'medal-tally') {
                eventSelector.style.display = 'block';
            } else {
                eventSelector.style.display = 'none';
            }

            changeBackgroundOnPanelCycle();

            if (!isPaused) {
                startRotation(); 
            }
        }

        nextButton.addEventListener('click', () => rotatePanel(1));
        prevButton.addEventListener('click', () => rotatePanel(-1));
        
        pauseButton.addEventListener('click', () => {
            isPaused = !isPaused;
            pauseButton.textContent = isPaused ? '‚ñ∂Ô∏è PLAY' : '‚è∏Ô∏è PAUSE';
            pauseButton.style.backgroundColor = isPaused ? '#00A86B' : 'var(--color-accent)';

            if (isPaused) {
                clearInterval(rotationIntervalId);
            } else {
                startRotation();
            }
        });

        speedToggle.addEventListener('click', () => {
            if (currentRotationSpeed === SPEED_SLOW) {
                currentRotationSpeed = SPEED_FAST;
                speedToggle.textContent = 'üöÄ FAST SWAP (5s)';
                speedToggle.style.backgroundColor = '#0070c0';
            } else {
                currentRotationSpeed = SPEED_SLOW;
                speedToggle.textContent = 'üê¢ SLOW SWAP (15s)';
                speedToggle.style.backgroundColor = '#555';
            }
            if (!isPaused) {
                startRotation(); 
            }
        });
        
        eventSelector.addEventListener('change', (e) => {
            loadHistoricalData(e.target.value);
        });


        // --- 4. INITIALIZATION ---

        function initDashboard() {
            renderSchedule();
            loadHistoricalData('2026-current');
            updateCountdown();
            startRotation();
            
            eventSelector.style.display = 'none';
            
            setInterval(updateCountdown, 1000); 
            window.addEventListener('resize', () => loadHistoricalData(eventSelector.value)); 
        }

        document.addEventListener('DOMContentLoaded', initDashboard);

    </script>
</body>
</html>
